name: Taxonomy build & validation
on:
  workflow_dispatch:
  push:

env:
  TAX_NAME: rj_taxonomy_2024

jobs:
  build:
    runs-on: ubuntu-latest
    name: Build taxonomy-package
    steps:
      - uses: actions/checkout@v4
      - run: mkdir -p build

      - uses: montudor/action-zip@v1
        with:
          args: zip -r build/${{ env.TAX_NAME }}  ./${{ env.TAX_NAME }}
      # - run: './script/worker.sh '

      - uses: actions/upload-artifact@master
        with:
          name: ${{ env.TAX_NAME }}.zip
          path: build/${{ env.TAX_NAME }}.zip


  test:
    runs-on: ubuntu-latest
    name: Test taxonomy-package
    needs: build
    steps:
      - uses: actions/checkout@v4
      - name: Install Arelle
        run: |
          pip install arelle-release
      - uses: actions/download-artifact@v4
        with:
          name: ${{ env.TAX_NAME }}.zip
          path: taxonomies
      # We willen de entrypoints kennen, dus manifest lezen
      - id: eplist
        run: |
          EP_LIST=`python scripts/find-entrypoints.py ${{ env.TAX_NAME }}` 
          echo ep_list=$EP_LIST >> $GITHUB_ENV
          echo $EP_LIST
      - run: |
          echo ${{ steps.vars.outputs.ep_list }}
      - id: taxtest
        run: |
          arelleCmdLine --help
      #- run: |
      #    arelleCmdLine --packages ${{ env.TAX_NAME }} --file "$env:ENTRYPOINT_LIST" --validate --logLevel=warning --logFile=arelle-taxo.log
